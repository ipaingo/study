<!DOCTYPE html>
<html>

<head>
</head>

<body>
    <canvas id="c" width="500" height="500"></canvas>

    <!-- фрагментный шейдер -->
    <script id="shader-fs" type="x-shader/x-fragment">
void main(void)
{
    gl_FragColor = vec4(0.0, 0.5, 0.0, 1.0);
}
</script>

    <!-- вершинный шейдер -->
    <script id="shader-vs" type="x-shader/x-vertex">
attribute vec3 a_vertex_position;

void main(void)
{
    gl_Position = vec4(a_vertex_position, 1.0);
}
</script>

    <script>
        let gl
        let shader_program
        let vertex_buffer

        // const canvas = document.getElementById("canvas3D")
        // try
        // {
        //     gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl")
        // }
        // catch(e)
        // {
        //     console.log(e)
        // }

        // function init_shaders()
        // {
        //     let fragment_shader = get_shader(gl.FRAGMENT_SHADER, 'shader-fs')
        //     let vertex_shader = get_shader(gl.VERTEX_SHADER, 'shader-vs')

        //     shader_program = gl.createProgram()
        //     gl.attachShader(shader_program, fragment_shader)
        //     gl.attachShader(shader_program, vertex_shader)

        //     gl.linkProgram(shader_program)

        //     gl.useProgram(shader_program)

        //     shader_program.vertexPositionAttribute = gl.getAttribLocation(shader_program, "a_vertex_position")
        //     gl.enableVertexAttribArray(shader_program.vertexPositionAttribute)
        // }

        // function get_shader(type, id)
        // {
        //     var source = document.getElementById(id).innerHTML
        //     var shader = gl.createShader(type)
        //     gl.shaderSource(shader, source)
        //     gl.compileShader(shader)

        //     if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
        //         alert("ошибка компиляции шейдера: " + gl.getShaderInfoLog(shader))
        //         gl.deleteShader(shader) 
        //         return null
        //     }
        //     return shader  
        // }

        // function init_buffers()
        // {
        //     vertex_buffer = gl.createBuffer()
        //     gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer)

        //     let vertices = [
        //          0.0,     1.0,    0.0,
        //          0.3333,  0.5,    0.0,
        //          1.0,     0.5,    0.0,
        //          0.6666,  0.0,    0.0,
        //          1.0,    -0.5,    0.0,
        //          0.3333, -0.5,    0.0,
        //          0.0,    -1.0,    0.0,
        //         -0.3333, -0.5,    0.0,
        //         -1.0,    -0.5,    0.0,
        //         -0.6666,  0.0,    0.0,
        //         -1.0,     0.5,    0.0,
        //         -0.3333,  0.5,    0.0,
        //          0.0,     1.0,    0.0,
        //     ]
        //     gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW)

        //     vertex_buffer.itemSize = 3
        //     vertex_buffer.numberOfItems = 13
        // }

        // function draw()
        // {    
        //     gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight)
        //     gl.clear(gl.COLOR_BUFFER_BIT)
        //     gl.vertexAttribPointer(shader_program.vertexPositionAttribute, 
        //                             vertex_buffer.itemSize, gl.FLOAT, false, 0, 0)
        //     gl.drawArrays(gl.LINE_STRIP, 0, vertex_buffer.numberOfItems)
        // }

        window.onload = function () {
            // gl.viewportWidth = canvas.width
            // gl.viewportHeight = canvas.height

            // init_shaders()
            // init_buffers()

            // // можно сделать цветной фон :)
            // // gl.clearColor(0.0, 0.0, 0.5, 0)

            // draw()  

            var canvas = document.querySelector("#c");
            var gl = canvas.getContext("webgl");
            if (!gl) {
                return;
            }

            gl.viewportWidth = canvas.width
            gl.viewportHeight = canvas.height

            var source = document.getElementById('shader-fs').innerHTML
            var fragment_shader = gl.createShader(gl.FRAGMENT_SHADER)
            gl.shaderSource(fragment_shader, source)
            gl.compileShader(fragment_shader)

            if (!gl.getShaderParameter(fragment_shader, gl.COMPILE_STATUS)) {
                alert("ошибка шейдера! " + gl.getShaderInfoLog(fragment_shader))
                gl.deleteShader(fragment_shader)
                fragment_shader = null
            }

            var source = document.getElementById('shader-vs').innerHTML
            var vertex_shader = gl.createShader(gl.VERTEX_SHADER)
            gl.shaderSource(vertex_shader, source)
            gl.compileShader(vertex_shader)

            if (!gl.getShaderParameter(vertex_shader, gl.COMPILE_STATUS)) {
                alert("ошибка шейдера! " + gl.getShaderInfoLog(vertex_shader))
                gl.deleteShader(vertex_shader)
                vertex_shader = null
            }


            shader_program = gl.createProgram()
            gl.attachShader(shader_program, fragment_shader)
            gl.attachShader(shader_program, vertex_shader)

            gl.linkProgram(shader_program)

            gl.useProgram(shader_program)

            shader_program.vertexPositionAttribute = gl.getAttribLocation(shader_program, "a_vertex_position")
            gl.enableVertexAttribArray(shader_program.vertexPositionAttribute)

            vertex_buffer = gl.createBuffer()
            gl.bindBuffer(gl.ARRAY_BUFFER, vertex_buffer)

            let vertices = [
                0.0,      1.0,    0.0,
                0.3333,   0.5,    0.0,
                1.0,      0.5,    0.0,
                0.6666,   0.0,    0.0,
                1.0,     -0.5,    0.0,
                0.3333,  -0.5,    0.0,
                0.0,     -1.0,    0.0,
                -0.3333, -0.5,    0.0,
                -1.0,    -0.5,    0.0,
                -0.6666,  0.0,    0.0,
                -1.0,     0.5,    0.0,
                -0.3333,  0.5,    0.0,
                0.0,      1.0,    0.0,
            ]
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW)

            vertex_buffer.itemSize = 3
            vertex_buffer.numberOfItems = 13


            gl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight)
            gl.clear(gl.COLOR_BUFFER_BIT)
            gl.vertexAttribPointer(shader_program.vertexPositionAttribute,
                vertex_buffer.itemSize, gl.FLOAT, false, 0, 0)
            gl.drawArrays(gl.LINE_STRIP, 0, vertex_buffer.numberOfItems)
        }
    </script>

</html>